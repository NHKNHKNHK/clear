# xsync远程分发脚本

```shell
#!/bin/bash
#1. 判断参数个数
if [ $# -lt 1 ]
then
  echo Not Enough Arguement!
  exit;
fi
#2. 遍历集群所有机器
for host in kk01 kk02 kk03
do
  echo ====================  $host  ====================
  #3. 遍历所有目录，挨个发送
  for file in $@
  do
    #4 判断文件是否存在
    if [ -e $file ]
    then
      #5. 获取父目录
  pdir=$(cd -P $(dirname $file); pwd)
      #6. 获取当前文件的名称
      fname=$(basename $file)
      ssh $host "mkdir -p $pdir"
      rsync -av $pdir/$fname $host:$pdir
    else
      echo $file does not exists!
    fi
  done
done
```



# 查看JVM进程脚本

## jpsall

```shell
#!/bin/bash
for host in kk01 kk02 kk03
do 
	echo "=========$host========="
	ssh $host 'jps'
done
```

## xcall

```shell
#! /bin/bash
for host in kk01 kk02 kk03
do
	echo "-----------$host---------------"
	ssh $host "source /etc/profile;  $*"
done
```



# Hadoop集群启停脚本

```shell
#!/bin/bash
if [ $# -lt 1 ]
then
    echo "No Args Input..."
    exit ;
fi
case $1 in
"start")
        echo " =================== 启动 hadoop集群 ==================="

        echo " --------------- 启动 hdfs ---------------"
        ssh kk01 "/opt/software/hadoop-3.2.2/sbin/start-dfs.sh"
        echo " --------------- 启动 yarn ---------------"
        ssh kk01 "/opt/software/hadoop-3.2.2/sbin/start-yarn.sh"
        echo " --------------- 启动 historyserver ---------------"
        ssh kk01 "/opt/software/hadoop-3.2.2/bin/mapred --daemon start historyserver"
;;
"stop")
        echo " =================== 关闭 hadoop集群 ==================="

        echo " --------------- 关闭 historyserver ---------------"
        ssh kk01 "/opt/software/hadoop-3.2.2/bin/mapred --daemon stop historyserver"
        echo " --------------- 关闭 yarn ---------------"
        ssh kk01 "/opt/software/hadoop-3.2.2/sbin/stop-yarn.sh"
   echo " --------------- 关闭 hdfs ---------------"
        ssh kk01 "/opt/software/hadoop-3.2.2/sbin/stop-dfs.sh"
;;
*)
    echo "Input Args Error..."
;;
esac
```



# Zookeeper启停脚本

## xzk.sh

基于root用户，且环境变量配置在 /etc/profile

```shell
#!/bin/bash
cmd=$1
if [ $# -gt 1 ] ; then echo param must be 1 ; exit ; fi
for (( i=1 ; i <= 3; i++ )) ; do
	tput setaf 5
	echo ============ kk0$i $@ ============
	tput setaf 9
	ssh kk0$i "source /etc/profile ; zkServer.sh $cmd"
done

```

## zk.sh

基于root用户，且环境变量配置在 /etc/profile

```shell
#!/bin/bash

case $1 in
"start")
	for i in kk01 kk02 kk03
	do
		echo "----------------zookeeper $i start------------------------"
		ssh $i " source /etc/profile;  zkServer.sh $1"
	done
;;
"stop")
	for i in kk01 kk02 kk03
	do
		echo "----------------zookeeper $i stop------------------------"
		ssh $i " source /etc/profile; zkServer.sh $1"
	done
;;
"status")
	for i in kk01 kk02 kk03
	do
		echo "----------------zookeeper $i status------------------------"
		ssh $i " source /etc/profile; zkServer.sh $1"
	done
;;
*)
		echo '输入参数有误(请输入:start|stop|status)!'
esac 
```



# Kafka启停脚本

## Kafka.sh

基于root用户，且环境变量配置在 /etc/profile

```shell
#！ /bin/bash

case $1 in
"start"){
	for host in kk01 kk02 kk03
	do
		echo "--------启动 $host KafKa--------"
		ssh $host "source /etc/profile; kafka-server-start.sh -daemon /opt/software/kafka_2.13-3.0.0/config/server.properties"
	done
	
};;
"stop"){
	for host in kk01 kk02 kk03
	do
		echo "--------停止 $host KafKa--------"
		ssh $host "source /etc/profile; kafka-server-stop.sh "
	done
};;
*)
        echo '输入参数有误(请输入:start|stop)!'
esac
```

## kf.sh 

基于普通用户nhk，且环境变量配置在 /etc/profile.d/*.sh

```shell
#! /bin/bash

if [ $# -lt 1 ]
then 
	echo "Usage: kf.sh {start | stop | kc [topic] | kp [topic] | list | delete [topic] | describe [topic]}"
 exit
fi
case $1 in 
start)
for i in kk01 kk02 kk03
do
	echo "====================> START $i KF <===================="
 	ssh $i kafka-server-start.sh -daemon /opt/software/kafka_2.13-3.0.0/config/server.properties 
done
;;
stop)
for i in kk01 kk02 kk03
do
	echo "====================> STOP $i KF <===================="
 	ssh $i kafka-server-stop.sh
done
;;
kc)
if [ $2 ]
then
	kafka-console-consumer.sh --bootstrap-server kk01:9092,kk02:9092,kk03:9092 --topic $2
else
	echo "Usage: kf.sh {start | stop | kc [topic] | kp [topic] | list | delete [topic] | describe [topic]}"
fi
;;
kp)
if [ $2 ]
then 
	kafka-console-producer.sh --bootstrap-server kk01:9092,kk02:9092,kk03:9092 --topic $2
else
	echo "Usage: kf.sh {start | stop | kc [topic] | kp [topic] | list | delete [topic] | describe [topic]}"
fi
;;
list)
	kafka-topics.sh --list --bootstrap-server kk01:9092,kk02:9092,kk03:9092
;;
describe)
if [ $2 ]
then
	kafka-topics.sh --describe --bootstrap-server kk01:9092,kk02:9092,kk03:9092 --topic $2
else
	echo "Usage: kf.sh {start | stop | kc [topic] | kp [topic] | list | delete [topic] | describe [topic]}"
fi 
;;
delete)
if [ $2 ]
then
	kafka-topics.sh --delete --bootstrap-server kk01:9092,kk02:9092,kk03:9092 --topic $2
else
 echo "Usage: kf.sh {start | stop | kc [topic] | kp [topic] | list | delete [topic] | describe [topic]}"
fi
;;
*)
	echo "Usage: kf.sh {start | stop | kc [topic] | kp [topic] | list | delete [topic] | describe [topic]}"
 exit
;;
esac
```



# Spark历史服务器启停脚本

```shell
#! /bin/bash

case $1 in
"start"){
	echo "--------启动 Spark历史服务器--------"
	$SPARK_HOME/sbin/start-history-server.sh
};;
"stop"){
	echo "--------停止 Spark历史服务器--------"
	$SPARK_HOME/sbin/stop-history-server.sh
};;
*)
	echo '输入参数有误(请输入:start|stop)!'
;;
esac
```





# 集群服务器关机脚本

```shell
#!/bin/bash
for host in kk03 kk02 kk01
do
        echo "=========$host 关机========="
        ssh $host 'sudo shutdown -h now'
done
```



测试

```shell
[nhk@kk01 bin]$ cluster-shutdown.sh 
=========kk03 关机=========
Connection to kk03 closed by remote host.
=========kk02 关机=========
Connection to kk02 closed by remote host.
=========kk01 关机=========

Connection closed by foreign host.

Disconnected from remote host(kk01) at 13:17:21.
```

