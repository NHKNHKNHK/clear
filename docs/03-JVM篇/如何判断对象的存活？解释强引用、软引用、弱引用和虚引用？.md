# 如何判断对象的存活？解释强引用、软引用、弱引用和虚引用？

在 Java 中，对象的存活可以通过引用类型来判断。Java 提供了四种不同的引用类型：强引用、软引用、弱引用和虚引用。

## **强引用（Strong Reference）**

最常见的引用类型，Java默认的引用实现

特点：

-   只要强引用存在，垃圾回收器永远不会回收被引用的对象。
-   当内存不足时，JVM宁愿抛出 `OutOfMemoryError` 错误，也不会回收强引用的对象。

```java
Object obj = new Object(); // 强引用
System.gc();
System.out.println(obj); // java.lang.Object@1540e19d
```

## **软引用（Soft Reference）**

通过 `SoftReference` 类创建的对象引用。只有内存不足才会回收

特点:

-   软引用所引用的对象，在 JVM 内存不足时会被回收。
-   通常用于实现内存敏感的缓存。

```java
Object obj = new Object();
SoftReference<Object> softRef = new SoftReference<>(obj); // 软引用
obj = null; // 原始强引用置空
System.gc();
System.out.println(softRef.get()); // 当内存不足时，softRef.get() 可能返回 null
```

## **弱引用（Weak Reference）**

通过 `WeakReference` 类创建的对象引用。不管内存足够与否，只要发生回收，都会回收

特点:

-   弱引用所引用的对象，在下一次垃圾回收时一定会被回收，无论内存是否充足。
-   常用于关联对象的映射表（如 `WeakHashMap`）。

```java
import java.lang.ref.WeakReference;

Object obj = new Object();
WeakReference<Object> weakRef = new WeakReference<>(obj); // 弱引用
obj = null; // 原始强引用置空
System.gc();
System.out.println(weakRef.get());// GC 后，weakRef.get() 返回 null
```

## **虚引用（Phantom Reference）**

通过 `PhantomReference` 类创建的对象引用。 可以理解为不是引用，与对象的回收没有关系。

主要作用是跟踪对象被回收的过程

特点:

-   虚引用不会影响对象的生命周期。
-   虚引用必须和引用队列（`ReferenceQueue`）联合使用。
-   主要用于跟踪对象被垃圾回收的状态，通常用于资源清理

```java
Object obj = new Object();
ReferenceQueue<Object> referenceQueue = new ReferenceQueue<>();
PhantomReference phantomRef = new PhantomReference(obj, referenceQueue);
obj = null; // 原始强引用置空
System.gc();
System.out.println(phantomRef.get()); // null

// 对象被回收后，phantomRef 会被加入到 queue 中
// while ture是因为gc与当前不在同一个线程
while (true) {
    Object a;
    if ((a = referenceQueue.poll()) != null) {
        System.out.println(a); // java.lang.ref.PhantomReference@677327b6
        break;
    }
}
```

| 引用类型 | 是否会被回收 | 回收条件               |
| :------- | :----------- | :--------------------- |
| 强引用   | 不会         | 永远不会被回收         |
| 软引用   | 会           | 内存不足时             |
| 弱引用   | 会           | 下一次垃圾回收时       |
| 虚引用   | 不直接决定   | 仅用于跟踪对象回收状态 |

