# 说说对象的创建过程？

## **口语化**

在实例化一个对象的过程中，JVM首先会检查目标对象是否已经被加载并初始化，如果没有。JVM会立即去加载目标类，调用目标类的构造器完成对象初始化。

目标类的类加载是通过类加载器来实现的。主要就是把一个类加载到内存里面

>   **类加载**
>
>   -   当程序首次使用某个类时，JVM（Java虚拟机）会加载该类的字节码文件（`.class` 文件）。
>   -   加载过程包括：
>       -   **加载**：将类的字节码加载到内存中。
>       -   **链接**：验证类的正确性、分配静态字段的内存空间，并解析符号引用。
>       -   **初始化**：执行类的静态代码块和静态变量的初始化。

然后是初始化的过程，这个步骤主要是对目标类里面的**静态变量和静态代码块进行初始化**。

当目标类被初始化以后，就可以在常量池中找到对应的类元信息了，并且目标对象的大小在类加载完成之后就已经确定了。 

所以这个时候就需要为新创建的对象根据目标对象的大小在堆内存中分配内存空间。

内存分配的方式一般有两种：**指针碰撞、空闲列表**。JVM会根据Java堆内存是否规整来决定内存的分配方法。



接下来JVM会把目标对象中的普通**成员变量初始化**为0值，比如int类型初始化为0，Integer类型初始化为null。这一步操作主要是为了保证对象里面的实例字段不用初始化即可直接使用。换句话说，就是程序能够直接获取这些字段的值。

然后JVM还需要对目标对象的**对象头做一些设置**，比如对象所属的类元信息、对象的GC分代年龄、hashCode、锁标记等。

完成这些步骤以后，对应JVM来说新对象的创建工作就已经完成了。

但是对于Java语言而言，对象创建才算刚刚开始。

接下来要做的就是**执行目标对象内部生成的init方法**初始化成员变量的值，执行构造快，最后调用目标对象的构造方法去完成对象的创建。

其中，init方法是Java文件编译之后在字节码文件里面去生成的，它是一个实例构造器，这个构造器中会把构造块，变量初始化，调用父类构造器等这样一些操作组装在一起，所以调用init方法能够完成这一系列的初始化动作

