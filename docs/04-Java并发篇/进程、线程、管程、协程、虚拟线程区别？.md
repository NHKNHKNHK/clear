# 进程、线程、管程、协程、虚拟线程区别？

## 进程（Process）

**进程是操作系统调度和分配资源的最小单位**。每个进程都有自己的内存空间、文件描述符、堆栈等资源。

当一个程序被运行时，从磁盘加载这个程序的代码至内存中，这时就开启了一个进程。

进程可以被视为程序的一个实例。大部分程序可以同时运行多个实例进程（如记事本、画图、浏览器等），也有的程序只有一个实例进程（如网易云音乐、360安全卫士）。

-   **进程的特点**
    -   **独立性**：进程之间是独立的，互不干扰。一个进程的崩溃不会影响其他进程。
    -   **资源丰富**：每个进程拥有独立的资源，包括内存、文件句柄等。
    -   **开销大**：创建和销毁进程的开销较大，进程间通信（IPC）也相对复杂。
    -   **上下文切换**：进程的上下文切换开销较大，因为需要切换内存空间和资源。

-   **使用场景**
    -   适用于需要强隔离和独立资源的场景，如独立的服务、应用程序等

## 线程 (Thread)

线程也被称为轻量级进程。

线程是进程内的执行单元，一个进程可以包含多个线程（一个或多个）。线程共享进程的资源（如内存空间、文件描述符）。一个进程中至少有一个线程。

线程是大多数操作系统进行时序调度的基本单元。

-   **线程的特点**
    -   **共享资源**：同一进程内的线程共享内存和资源，通信方便。
    -   **轻量级**：与进程相比，线程更加”轻量级“，线程的创建和销毁开销较小，上下文切换较快。
    -   **并发执行**：多线程可以并发执行，提高程序的响应速度和资源利用率。
    -   **同步问题**：由于共享资源，线程间需要同步机制（如锁）来避免资源竞争和数据不一致。

-   **使用场景**
    -   适用于需要并发执行的任务，如多任务处理、并行计算等。

>   注意：
>
>   -   不同的进程之间是不共享内存的。
>   -   进程之间的数据交换和通信的成本很高。
>       -   同一台计算机中的进程通信称为IPC（Inter-process communication）
>       -   不同计算机之间的进程通信，需要通过网络，并遵循一定的协议，如http


## **管程 (Monitor)** 

Monitor（监视器），也就是我们平时说的锁。

管程是一种高级的同步机制，用于管理共享资源的并发访问。它将共享资源和访问资源的代码封装在一起，通过条件变量和互斥锁来实现同步。

JVM中同步是基于进入和退出监视器对象(Monitor,管程对象)来实现的，每个对象实例都会有一个Monitor对象，Monitor对象会和Java对象一同创建并销毁，它底层是由C++语言来实现的。

```java
Object o = new Object();
new Thread(() ->{
    synchronized (o){  // 这里的o即Object对象可以理解为Monitor

    }
},"t1").start();
```

:::tip

**《深入理解Java虚拟机》**

执行线程就要求先成功持有管程，然后才能执行方法，最后当方法完成（无论是正常完成还是非正常完成）时释放管程。在方法执行期间，执行线程持有了管程，其他任何线程都无法再获取到同一个管程。

:::

-   **管程特点** 
    -   封装性：将共享资源和同步代码封装在一起，提供更高层次的抽象。
    -   互斥访问：通过互斥锁确保同一时刻只有一个线程可以访问共享资源。
    -   条件同步：使用条件变量来协调线程间的执行顺序。

-   **使用场景** 
    -   适用于需要对共享资源进行复杂同步操作的场景，如操作系统内核、并发数据结构等。



## **协程 (Coroutine)** 

协程是一种比线程更轻量级的并发执行单元。协程由程序自身调度，而不是由操作系统内核调度。协程可以在执行过程中主动让出控制权，以便其他协程运行。

-   **协程特点** 
    -   **轻量级**：协程的创建和切换开销极小，通常在用户态完成。
    -   **主动让出**：协程通过显式的调用（如yield）让出控制权，实现合作式多任务。
    -   **非抢占式**：协程之间的切换是合作式的，不存在抢占问题。
    -   **栈独立**：每个协程有自己的栈，避免了线程间共享栈带来的同步问题。

-   **使用场景** 
    -   适用于需要大量并发任务且切换频繁的场景，如高并发网络服务器、异步编程等。



## **虚拟线程 (Virtual Thread)** 

虚拟线程是一个新概念，特别是在 Java 的 Project Loom 中引入。虚拟线程是一种轻量级线程，由 JVM 管理，旨在简化并发编程并提高并发性能。

-   **特点** 
    -   **轻量级**：虚拟线程的创建和销毁开销极小，可以高效地管理数百万个线程。
    -   **自动管理**：由 JVM 自动调度和管理，不需要开发者显式地管理线程池。
    -   **兼容性**：与传统的 Java 线程 API 兼容，开发者可以用熟悉的线程模型编写高并发程序。
    -   **阻塞操作**：虚拟线程可以在阻塞操作（如 I/O 操作）时高效地让出 CPU，而不会浪费资源。

-   **使用场景** 
    -   适用于高并发应用程序，如高性能服务器、Web 应用等。
