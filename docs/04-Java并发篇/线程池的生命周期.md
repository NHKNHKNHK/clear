# 线程池的生命周期

从`ThreadPoolExecutor`源码中注释中得知线程池的生命周期主要包括五种状态，如下：
```txt
 * The runState provides the main lifecycle control, taking on values:
 *
 *   RUNNING:  Accept new tasks and process queued tasks
 *   SHUTDOWN: Don't accept new tasks, but process queued tasks
 *   STOP:     Don't accept new tasks, don't process queued tasks,
 *             and interrupt in-progress tasks
 *   TIDYING:  All tasks have terminated, workerCount is zero,
 *             the thread transitioning to state TIDYING
 *             will run the terminated() hook method
 *   TERMINATED: terminated() has completed
```

- RUNNING（运行中）：正常运行，接受新任务并处理队列中的任务
- SHUTDOWN（关闭中）：不再接受新任务，但会继续处理队列中的剩余任务
- STOP（停止）：拒绝新任务且不再处理队列任务，同时中断正在执行的任务
- TIDYING（整理中）：所有任务已终止，工作线程数为0，即将执行terminated()钩子方法
  - 就像你上班干完活，所有人都走了，正在关灯锁门做最后收尾工作
- TERMINATED（终止）‌：terminated()方法执行完毕，线程池完全终止



## ‌状态转换触发条件‌

RUNNING→SHUTDOWN‌：调用shutdown()方法，优雅关闭线程池。‌

RUNNING/SHUTDOWN→STOP‌：调用shutdownNow()方法，强制中断所有任务。

STOP→TIDYING‌：当线程池和工作队列均为空时自动转换。‌

TIDYING→TERMINATED‌：执行完terminated()方法后进入最终状态。

## 关键方法对比‌

`shutdown()`：仅拒绝新任务，允许队列任务执行完成。 通过interruptIdleWorkers()中断空闲线程。

`shutdownNow()`： 立即中断所有线程（包括运行中的任务）。返回未处理的队列任务列表