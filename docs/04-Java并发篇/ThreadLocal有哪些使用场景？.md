# ThreadLocal有哪些使用场景？

ThreadLocal是可以**基于副本的隔离机制**来保证共享变量修改的安全性，他的使用场景有很多

-   **线程的上下文传递**：在跨线程调用的场景中，可以使用ThreadLocal在不修改方法签名的情况下传递线程上下文新
    -   比如在框架和中间件里面，把请求的相关信息（用户信息、请求id等）存储在ThreadLocal中，在后续的请求处理链路中，都可以方便的去访问这些信息

-   **数据库的连接管理**：在使用线程池的情况下，可以将数据库的连接存储在ThreadLocal中，这样每个线程可以独立管理自己的数据库连接，避免了线程之间的竞争和冲突。
    -   比如Mybatis中的SqlSession对象就使用了ThreadLocal来存储当前线程的数据库会话信息

-   **事务管理**：在一些需要手动管理事务的场景中，可以使用ThreadLocal来存储事务的上下文，每个线程可以独立的控制自己的事务，保证事务的隔离性。
    -   比如Spring中的TransactionSynchronizationManager类就使用了ThreadLocal来存储当前线程的事务相关的上下文信息

不过在使用ThreadLocal需要注意使用规范，避免内存泄露的问题
