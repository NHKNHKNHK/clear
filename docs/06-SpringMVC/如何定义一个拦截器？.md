# 如何在 Spring MVC 中配置拦截器？|如何定义一个拦截器？

## **口语化**

在 Spring MVC 中配置拦截器有两种常见方式：使用 Java 配置类和使用 XML 配置文件

使用 Java 配置类：

1）就是定义一个类并使用@Component注解修饰，**实现`HandlerInterceptor`接口，重写接口中的三个方法**，分别是preHandle、postHandle、afterCompletion。

2）这三个方法分别在请求处理之前执行、在请求处理之后执行、在整个请求完成之后（包括视图渲染之后）执行。

3）接着在MVC配置类（实现 `WebMvcConfigurer` 接口的类）中，**注册**这个拦截器。

使用 XML 配置文件，这是早期的一种配置方式

1）**创建一个拦截器类**：实现 `HandlerInterceptor` 接口。与Java配置类的方式一致

2）**在 XML 配置文件中注册拦截器**。



##  **使用 Java 配置类**

通过 Java 配置类来配置拦截器是一种更现代和推荐的方式。需要实现 `WebMvcConfigurer` 接口，并在其中注册你的拦截器。

1.  **创建一个拦截器类**：实现 `HandlerInterceptor` 接口。
2.  **创建一个配置类**：实现 `WebMvcConfigurer` 接口，并在其中注册拦截器

**拦截器类：**

```java
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class MyInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println("Pre Handle method is Calling");
        return true; // 返回 true 继续处理请求，返回 false 中止请求
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println("Post Handle method is Calling");
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception exception) throws Exception {
        System.out.println("Request and Response is completed");
    }
}
```

**配置类：**

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Autowired
    private MyInterceptor myInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(myInterceptor).addPathPatterns("/**"); // 拦截所有请求
    }
}
```

## 使用 XML 配置文件

如果你使用的是 XML 配置文件，可以通过 `<mvc:interceptors>` 元素来配置拦截器。

1.  **创建一个拦截器类**：实现 `HandlerInterceptor` 接口。
2.  **在 XML 配置文件中注册拦截器**。

**拦截器类：**

```java
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class MyInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println("Pre Handle method is Calling");
        return true; // 返回 true 继续处理请求，返回 false 中止请求
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println("Post Handle method is Calling");
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception exception) throws Exception {
        System.out.println("Request and Response is completed");
    }
}
```

**XML 配置文件：**

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/mvc
                           http://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <mvc:interceptors>
        <mvc:interceptor>
            <mvc:mapping path="/**"/>
            <bean class="com.example.MyInterceptor"/>
        </mvc:interceptor>
    </mvc:interceptors>

</beans>
```
