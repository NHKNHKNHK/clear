# MySQL的数据目录


## MySQL8的主要目录结构

```shell
find / -name mysql
```

### 数据库文件的存放路径

```mysql
show variables like 'datadir'; # /var/lib/mysql/
```

### 相关命令目录

**相关命令目录：/usr/bin 和/usr/sbin。**

### 配置文件目录

**配置文件目录：/usr/share/mysql-8.0（命令及配置文件），/etc/mysql（如my.cnf）**


## 数据库和文件系统的关系

### 表在文件系统中的表示

#### InnoDB存储引擎模式

##### 表结构

为了保存表结构，`InnoDB`在`数据目录`下对应的数据库子目录下创建了一个专门用于`描述表结构的文件`

```
表名.frm
```

比如我们在test数据库中创建了一个表：`create table test.t1(id int);`

那在数据库 test 对应的子目录下就会创建一个名为 `t1.frm` 的用于描述表结构的文件。.frm文件的格式在不同的平台上都是相同的。这个后缀名为.frm是以 `二进制格式` 存储的，我们直接打开是乱码的。


##### 表中数据和索引

###### 系统表空间（system tablespace）

默认情况下，InnoDB会在数据目录下创建一个名为`ibdata1`、大小为`12M`的`自拓展`文件，这个文件就是对应的`系统表空间`在文件系统上的表示。

###### 独立表空间（file-per-table tablespace）

在MySQL5.6.6以及之后的版本中，InnoDB并不会默认的把各个表的数据存储到系统表空间中，而是为`每一个表建立一个独立表空间`，也就是说我们创建了多少个表，就有多少个独立表空间。使用`独立表空间`来存储表数据的话，会在该表所属数据库对应的子目录下创建一个表示该独立表空间的文件，文件名和表名相同。

```
表名.ibd
```

> MySQL8.0中不再单独提供`表名.frm`，而是合并在`表名.ibd`文件中。

###### 系统表空间与独立表空间的设置

我们可以自己指定使用`系统表空间`还是`独立表空间`来存储数据，这个功能由启动参数`innodb_file_per_table`控制

```ini
[server] 
innodb_file_per_table=0 # 0：代表使用系统表空间； 1：代表使用独立表空间
```

###### 其他类型的表空间

随着MySQL的发展，除了上述两种老牌表空间之外，现在还新提出了一些不同类型的表空间，比如通用表空间（general tablespace）、临时表空间（temporary tablespace）等。

#### MyISAM存储引擎模式

##### 表结构

在存储表结构方面， MyISAM 和 InnoDB 一样，也是在`数据目录`下对应的数据库子目录下创建了一个专门用于描述表结构的文件

```
表名.frm
```

##### 表中数据和索引

在MyISAM中的索引全部都是`二级索引`，该存储引擎的`数据和索引是分开存放`的。所以在文件系统中也是使用不同的文件来存储数据文件和索引文件，同时表数据都存放在对应的数据库子目录下。

```
test.frm 存储表结构 #MySQL8.0 改为了 b.xxx.sdi
test.MYD 存储数据 (MYData) 
test.MYI 存储索引 (MYIndex)
```

### 小结

举例：数据库a ， 表b

1、如果表b采用 InnoDB ，data\a中会产生1个或者2个文件：
- `b.frm`：描述表结构文件，字段长度等
- 如果采用 `系统表空间` 模式的，数据信息和索引信息都存储在 `ibdata1` 中
- 如果采用 `独立表空间` 存储模式，data\a中还会产生 `b.ibd` 文件（存储数据信息和索引信息）

此外：

① MySQL5.7 中会在data/a的目录下生成 db.opt 文件用于保存数据库的相关配置。比如：字符集、比较
规则。而MySQL8.0不再提供db.opt文件。

② MySQL8.0中不再单独提供b.frm，而是合并在b.ibd文件中。

2、如果表b采用 MyISAM ，data\a中会产生3个文件：

- MySQL5.7 中： `b.frm` ：描述表结构文件，字段长度等。
- MySQL8.0 中 `b.xxx.sdi` ：描述表结构文件，字段长度等
- `b.MYD` (MYData)：数据信息文件，存储数据信息(如果采用独立表存储模式)
- `b.MYI` (MYIndex)：存放索引信息文件

