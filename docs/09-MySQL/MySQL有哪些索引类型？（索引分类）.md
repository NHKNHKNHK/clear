---
permalink: /mysql/index-category
---

# MySQL有哪些索引类型？（索引分类）

MySQL的索引包括普通索引、唯一索引、全文索引、单列索引、多列索引和空间索引等。

- 按照 **功能逻辑** 来说，索引主要有 4 种，分别是普通索引、唯一索引、主键索引、全文索引。（补充：按功能逻辑来说，还有一种空间索引，但是很多引擎不支持，目前仅MyISAM支持）
- 按照 **物理实现方式** 来说 ，索引可以分为 2 种：聚簇索引和非聚簇索引。
- 按照 **作用字段个数** 进行划分，分成单列索引和联合索引。

## 普通索引

在创建普通索引时，不附加任何限制条件，只是用于提高查询效率。这类索引可以创建在`任何数据类型`中，其值是否唯一和非空，要由字段本身的完整性约束条件决定。建立索引以后，可以通过索引进行查询。

例如，在表student的字段name上建立一个普通索引，查询记录时就可以根据该索引进行查询。

## 唯一索引

唯一性索引使用`UNIQUE`参数可以设置索引为唯一性索引，在创建唯一性索引时，限制该索引的值必须是唯一的，但允许有空值。在一张数据表里`可以有多个`唯一索引。

例如，在表student的字段email中创建唯一性索引，那么字段 email 的值就必须是唯一的。通过唯一性索引，可以更快速地确定某条记录。

## 主键索引

主键索引就是一种`特殊的唯一性索引`，在唯一索引的基础上增加了不为空的约束，也就是 `NOT NULL` + `UNIQUE`，一张表里`最多只有一个`主键索引。

**为什么一张表最多只能有一个主键索引？**

这是由主键索引的物理实现方式决定的，因为数据存储在文件中只能按照一种顺序进行存储。

## 单列索引

在表中的单个字段上创建索引。单列索引只根据该字段进行索引。单列索引可以是普通索引，也可以是唯一性索引，还可以是全文索引。只要保证该索引只对应一个字段即可。一个表可以`有多个`单列索引。

## 多列 (组合、联合) 索引

多列索引是在表的`多个字段组合`上创建一个索引。该索引指向创建时对应的多个字段，可以通过这几个字段进行查询，但是只有查询条件中使用了这些字段中的第一个字段时才会被使用。

例如，在表中的字段 id、name 和 gender 上建立一个多列索引`idx_id_name_gender`，只有在查询条件中使用了字段 id 时该索引才会被使用。使用组合索引时遵循[最左前缀原则](./MySQL索引最左前缀匹配原则？.md)。

## 全文索引

全文索引（也称全文检索）是目前`搜索引擎`使用的一种关键技术。它能够利用【`分词技术`】等多种算法智能分析出文本文字中关键词的频率和重要性，然后按照一定的算法规则智能地筛选出我们想要的搜索结果。全文索引非常适合大型数据集，对于小的数据集，它的用处比较小。

使用参数`FULLTEXT`可以设置索引为全文索引。在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。

全文索引只能创建在`CHAR`、`VARCHAR`或`TEXT`类型及其系列类型的字段上，**查询数据量较大的字符串类型的字段时，使用全文索引可以提高查询速度**。

例如，表student的字段information是TEXT类型，该字段包含了很多文字信息。在字段 information 上建立全文索引后，可以提高查询字段 information 的速度。

全文索引典型的有两种类型：自然语言的全文索引和布尔全文索引。

- 自然语言搜索引擎将计算每一个文档对象和查询的相关度。这里，相关度是基于匹配的关键词的个数，以及关键词在文档中出现的次数。**在整个索引中出现次数越少的词语，匹配时的相关度就越高**。相反，非常常见的单词将不会被搜索，如果一个词语的在超过 50% 的记录中都出现了，那么自然语言的搜索将不会搜索这类词语

:::info

MySQL 数据库从 3.23.23 版开始支持全文索引，但 MySQL5.6.4 以前只有 Myisam 支持，5.6.4 版本以后innodb 才支持

但是官方版本不支持中文分词，需要第三方分词插件。

在 5.7.6 版本，MySQL 内置了`ngram`全文解析器，用来支持亚洲语种的分词。

测试或使用全文索引时，要先看一下自己的 MySQL 版本、存储引擎和数据类型是否支持全文索引。

:::

随着大数据时代的到来，关系型数据库应对全文索引的需求已力不从心，逐渐被 solr、ElasticSearch 等专门的搜索引擎所替代。

## 补充：空间索引

使用参数`SPATIAL`可以设置索引为空间索引。空间索引只能建立在空间数据类型上，这样可以提高系统获取空间数据的效率。

MySQL 中的空间数据类型包括 `GEOMETRY`、`POINT`、`LINESTRING` 和 `POLYGON` 等。

目前只有 MyISAM 存储引擎支持空间检索，而且索引的字段不能为空值。对于初学者来说，这类索引很少会用到

## 小结：存储引擎对索引类型的支持情况

不同的存储引擎支持的索引类型也不一样

- InnoDB ：支持 B-tree、Full-text 等索引，不支持 Hash索引
- MyISAM ：支持 B-tree、Full-text 等索引，不支持 Hash 索引
- Memory ：支持 B-tree、Hash 等索引，不支持 Full-text 索引
- NDB ：支持 Hash 索引，不支持 B-tree、Full-text 等索引
- Archive ：不支持 B-tree、Hash、Full-text 等索引

## 索引基本语法

> [创建、查看、删除索引](./创建、查看、删除索引.md)

## MySQL 8.0索引新特性

### 降序索引

在创建索引时，可以指定索引的顺序，即索引值升序或降序

可以分别在MySQL5.7、MySQL8.0分别执行如下SQL，在MySQL 5.7中索引依旧是按照升序存储，而在MySQL 8.0中索引则是按照降序存储。

```sql
CREATE TABLE ts1(a int,b int,index idx_a_b(a,b desc));
```

下面可以测试降序索引在执行计划中的表现

分别在MySQL 5.7版本和MySQL 8.0版本的数据表ts1中插入800条随机数据，执行语句如下：

```sql
DELIMITER //
CREATE PROCEDURE ts_insert()
BEGIN
DECLARE i INT DEFAULT 1;
WHILE i < 800
DO
insert into ts1 select rand()*80000,rand()*80000;
SET i = i + 1;
END WHILE;
commit;
END //
DELIMITER ;

# 调用
CALL ts_insert();
```

在MySQL 5.7版本中查看数据表ts1的执行计划，结果如下：

```sql
EXPLAIN SELECT * FROM ts1 ORDER BY a,b DESC LIMIT 5;
```

从结果可以看出，执行计划中扫描数为799，而且使用了Using filesort

:::tip
Using filesort是MySQL中一种速度比较慢的外部排序，能避免是最好的。多数情况下，管理员可以通过优化索引来尽量避免出现Using filesort，从而提高数据库执行速度。
:::

在MySQL 8.0版本中查看数据表ts1的执行计划。从结果可以看出，执行计划中扫描数为5，而且没有使用Using filesort

:::warning
降序索引只对查询中特定的排序顺序有效，如果使用不当，反而查询效率更低。

例如，上述查询排序条件改为order by a desc, b desc，MySQL 5.7的执行计划要明显好于MySQL 8.0
:::

将排序条件修改为order by a desc, b desc后，下面来对比不同版本中执行计划的效果。

在MySQL 5.7版本中查看数据表ts1的执行计划，结果如下：

```sql
EXPLAIN SELECT * FROM ts1 ORDER BY a DESC, b DESC LIMIT 5;
```

在MySQL 8.0版本中查看数据表ts1的执行计划

从结果可以看出，修改后MySQL 5.7的执行计划要明显好于MySQL 8.0

