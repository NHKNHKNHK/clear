# 什么是唯一索引？

唯一索引（Unique Index）是数据库中的一种约束机制，用于确保索引列中的所有值都是唯一的。换句话说，唯一索引可以防止在该列中插入重复的值。

可以是单列唯一索引，也可以是多列唯一索引。

它与“普通索引”类似，不同点就是：索引列的值必须是唯一的，但允许有空值。（因为 `NULL` 不等于 `NULL`）

## **特点**

-   **唯一性**：唯一索引要求索引列中的值不能重复。
-   **允许多个 NULL 值**：大多数数据库系统允许唯一索引列中有多个 `NULL` 值（因为 `NULL` 不等于 `NULL`）。
-   **加速查询**：唯一索引除了保证数据的唯一性外，还可以加快查询速度。
    -   但插入数据可能会比普通索引慢

## **与主键的区别**

| 特性              | 主键                   | 唯一索引                  |
| :---------------- | :--------------------- | :------------------------ |
| **是否允许 NULL** | 不允许                 | 允许（通常支持多个 NULL） |
| **数量限制**      | 每张表只能有一个主键   | 每张表可以有多个唯一索引  |
| **用途**          | 标识表中每一行的唯一性 | 确保列值的唯一性          |

------

## **应用场景**

-   **用户注册系统**：确保用户的邮箱、手机号、身份证等唯一。
-   **商品管理系统**：确保商品编号唯一。
-   **金融系统**：确保交易流水号唯一。


## **什么使用应该使用唯一索引呢？**

唯一索引最大的好处就是能够保证唯一性。

这看似没有什么价值，有的人会说，我在业务层面做重复性检测不就好了吗？问题就在于“业务是无法确保唯一性的”，除非你写的代码没有debug。

很多时候，为了保证唯一性，如果不在数据库层面加以限制，总有一天会出现脏数据。

又有的人会说，既然要保证不想重复，为什么不使用主键索引呢？

-   我们确实可以通过主键索引来保证唯一，但是如果你的数据不能保证插入的有序性，可能会导致查询效率降低。
-   唯一索引还有一个好处就是可以为空，真实的业务场景是有这个需求的。比如，创建用户，你不能一上来就让用户填写身份证等信息。



## **唯一索引是否会影响性能呢？**

这里和普通索引做对比，比较查询和插入的场景。

**查询时：**

一般情况下，我们是使用b+树索引，它是从根节点开始层序遍历到叶子节点的，数据页内部通过二分搜索。

-   普通索引：查询到满足条件的第一条数据，还需要继续查找下一条记录，直到找不到满足条件的记录
-   唯一索引：查到第一个满足条件的记录，就停止搜索

>   InnoDB它是以页为单位进行读写的，我们读一条记录，并不是从磁盘加载一条记录，而是以页为单位整体读到内存中的

普通索引比唯一索引就多了一次**查找和判断下一条**记录的操作，也就是多了一次指针寻找数据和一次计算。

当然还有一种特殊情况，就是读取到的数据刚好是数据页的最后一条了，但这种情况概率极低，几乎忽略不计。

整体上看来去，查询的性能差距不大

**插入时：**

假设需要在2和6之间插入一个数据3

在内存中的情况：

-   普通索引：找到2和6之间的位置 -> 插入值 -> 结束
-   唯一索引：找到2和6之间的位置 -> **判断有没有冲突** -> 插入值 -> 结束

不在内存中的情况：

-   普通索引：将更新记录在`change buffer` -> 结束
-   唯一索引：将数据页读入内存 ->  **判断有没有冲突** -> 插入值 -> 结束

读取数据到内存中涉及到了随机IO访问，这是数据库里面成本最高的操作之一，而`change buffer`就可以减少这种随机磁盘访问，所以性能提升比较明显。


## 补充

MySQL会给唯一约束的列创建一个唯一索引

唯一约束被删除时，唯一索引也会被删除