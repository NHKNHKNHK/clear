---
permalink: /25/10/24/mysql/leftmost-match
---

# MySQL索引最左前缀匹配原则？

在MySQL中，最左前缀匹配是指在查询中利用索引的最左边的一部分来进行匹配。指你执行查询时，如果查询条件涉及到了组合索引的前几个列，MySQL 就可以利用这个复合索引来进行匹配。


组合索引，指的就是有多个字段组成的一个联合索引，如 `idx_col1_col2_col3 (col1,col2,col3)`

假如我们创建了一个组合索引 `(col1, col2, col3)`，如果你的查询条件是针对 col1 、 (col1, col2)或者(col1, col2, col3)，那么MySQL可以利用这个复合索引进行最左前缀匹配。


而且如果你用的是 (col1, col3)也是可以走索引的，只不过他用到的是 col1这个字段的索引。

但是，如果查询条件涉及到的列只有 col2 或者 只有col3或者只有col2和col3，总之就是如果不包含col1的话，那么是没有遵守最左前缀匹配，那么通常情况下（不考虑索引跳跃扫描等其他优化），就不能利用这个索引进行最左前缀匹配。

:::warning
并且，需要注意的是，最左前缀匹配和查询条件的顺序没有关系，不管你写的是`where col1 = "zs" and col2 = "666" `还是 `where col2 = "666" and col1 = "zs"` 对结果都没有影响，该命中还是会命中。
:::

但是，需要大家注意的是，很多人会以为创建一个组合索引 (col1, col2, col3)的时候，数据库会创建出三个索引 (col1)、 (col1, col2)和(col1, col2, col3)，这么理解其实是不对的，他创建的只是一棵B+树，只不过在这颗树中，他是先按照col1排序，在col1相同时再按照col2排序的，col2相同再按照col3排序。



另外，如果不涉及到联合索引，单个字段的索引也需要遵守最左前缀，即有一个字段值为"abc"时，当我们使用like进行模糊匹配时，`like "ab%"`是可以走索引的，而`"%bc"、"b%c"`都是不行的，就是因为后者不遵守最左前缀匹配的原则了。

## 为什么需要遵循最左前缀匹配

MySQL的Innodb引擎中，索引是通过B+树来实现的。不管是普通索引还是联合索引，都需要构造一个B+树的索引结构。

那么，我们都知道普通索引的存储结构是在B+树的每个非叶子节点上记录索引的值，而这棵B+树的叶子节点上记录的是索引的值和聚簇索引（主键索引）的值的。

// todo未完待续