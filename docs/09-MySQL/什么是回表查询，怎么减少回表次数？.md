# 什么是回表查询，怎么减少回表次数？:star:

:::tip
在了解回表查询之前，需要先了解聚簇索引和非聚簇索引：[MySQL聚簇索引与非聚簇索引](./MySQL聚簇索引与非聚簇索引.md)
:::

## 口语化

在InnDB中，聚簇索引是指B+树的叶子节点存储的是整行用户记录，而非聚簇索引的叶子节点存储的是主键值。当我们的查询条件中包含非聚集索引字段时，需要先通过非聚簇索引找到主键值，再通过主键值进行在聚集索引中查找完整的行数据，这个过程称为回表查询。

## 回表查询

- **定义**：当通过索引找到记录的主键值或其他索引字段后，需要再次访问实际的数据行以获取完整数据的过程称为回表查询。
- **为什么需要回表**：如果查询的字段不在索引中，或者查询需要完整的数据行信息，那么数据库引擎需要根据索引中的主键或唯一键回到主表中查找完整的记录。
- **代价**：回表查询会增加I/O开销，降低查询效率。

## demo

假设有一个表`Employees`。如果执行如下查询：

```sql
SELECT * FROM Employees WHERE name ='Alice' AND age >30;
```

假设我们在`name`字段上建立了索引，且`name`索引只存储了`name`和主键`id`，那么对于每个满足`name = 'Alice'`的记录，数据库需要通过主键`id`回到主表中查找完整的记录，包括`age`和其他字段。此过程即为回表查询。

## 扩展

在InnoDB 中，**使用主键查询**的时候，是效率更高的， 因为这个过程不需要回表。另外，依赖**覆盖索引**、**索引下推**等技术，我们也可以通过优化索引结构以及SQL语句减少回表的次数。

### 覆盖索引

> [MySQL的覆盖索引？](./MySQL的覆盖索引？.md)

### 索引下推

> [什么是索引下推？](./什么是索引下推？.md)