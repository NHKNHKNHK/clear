# 创建、查看、删除索引

## 创建索引

MySQL 支持多种方法在单个或多个列上创建索引：在创建表的定义语句 `CREATE TABLE` 中指定索引列，使用 `ALTER TABLE` 语句在存在的表上创建索引，或者使用 `CREATE INDEX` 语句在已存在的表上添加索引。

### 创建表的时候创建索引

#### CREATE TABLE：隐式的方式创建索引

使用CREATE TABLE创建表时，除了可以定义列的数据类型外，还可以定义（声明）主键约束、外键约束或者唯一性约束，而不论创建哪种约束，在定义约束的同时相当于在指定列上创建了一个索引。

举例：

```sql
CREATE TABLE dept(
  dept_id INT PRIMARY KEY AUTO_INCREMENT,
  dept_name VARCHAR(20)
);

CREATE TABLE emp(
  emp_id INT PRIMARY KEY AUTO_INCREMENT,
  emp_name VARCHAR(20) UNIQUE,
  dept_id INT,
  CONSTRAINT emp_dept_id_fk FOREIGN KEY(dept_id) REFERENCES dept(dept_id)
);
```

:::warning

定义主键约束的字段会自动创建一个主键索引

定义唯一性约束的字段会自动创建一个唯一索引

定义外键约束的字段会自动创建一个普通索引

:::

#### CREATE TABLE：显式创建索引

可以在表创建时 【显式创建索引】 或者 【通过表结构修改创建索引】

```sql
CREATE TABLE table_name [col_name datatype]
[UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY] [index_name] (col_name[length],...) [ASC | DESC]

```

- `UNIQUE`、`FULLTEXT`和`SPATIAL`为可选参数，分别表示唯一索引、全文索引和空间索引；
- `INDEX`与`KEY`为同义词，两者的作用相同，用来指定创建索引；
- `index_name`指定索引的名称，为可选参数，如果不指定，那么MySQL默认col_name为索引名；
- `col_name`为需要创建索引的字段列，该列必须从数据表中定义的多个列中选择；
- `length`为可选参数，表示索引的长度，只有字符串类型的字段才能指定索引长度；
- `ASC` 或 `DESC` 指定升序或者降序的索引值存储。
  - 注意：在创建索引时指定索引值降序或升序只在MySQL 8.x 版本生效

##### 创建普通索引

在book表中的year_publication字段上建立普通索引，SQL语句如下：

```sql{7}
CREATE TABLE book(
  book_id INT ,
  book_name VARCHAR(100),
  authors VARCHAR(100),
  info VARCHAR(100) ,
  comment VARCHAR(100),
  year_publication YEAR,
  INDEX(year_publication)
);
```

##### 创建唯一索引

举例：

```sql{4}
CREATE TABLE test1(
  id INT   NOT NULL,
  name varchar(30) NOT NULL,
  UNIQUE INDEX uk_idx_id(id)
);
```

该语句执行完毕之后，使用SHOW CREATE TABLE查看表结构：

```sql
SHOW INDEX FROM test1 \G
```

:::tip

创建唯一索引的字段，其值必须是唯一的，但是允许为NULL。效果与唯一约束一致

:::

##### 创建主键索引

可以通过定义主键约束的方式创建主键索引（隐式创建）

也可以显式的创建主键索引（显式创建）

```sql{5}
CREATE TABLE student (
  id INT(10) UNSIGNED AUTO_INCREMENT ,
  student_no VARCHAR(200),
  student_name VARCHAR(200),
  PRIMARY KEY(id)
);
```

##### 创建单列索引

前面创建的索引都是单列索引

```sql
CREATE TABLE test2 (
  id INT NOT NULL,
  name VARCHAR(100) NULL,
  INDEX single_idx_name(name(20))
);
```

##### 创建联合索引

举例：创建表 test3，在表中的 id、name 和 age 字段上建立组合索引，SQL 语句如下：

```sql{6}
CREATE TABLE test3(
  id INT(11) NOT NULL,
  name CHAR(38) NOT NULL,
  age INT(11) NOT NULL,
  info VARCHAR(255),
  INDEX multi_idx(id,name,age)
);
```

:::tip
建立联合索引时，可以不起名，他会自动用字段命名，但是为了见名知意，建议起名

建立联合索引时，字段的顺序很重要，MySQL会根据字段的顺序建立索引，如果查询条件是按照字段的顺序来的话，那么效率是最高的。

详细查看：[最左匹配原则](./MySQL索引最左前缀匹配原则？.md)

:::

##### 创建全文索引

FULLTEXT全文索引可以用于全文搜索，并且只为`CHAR`、`VARCHAR`和`TEXT`列创建索引。索引总是对整个列进行，不支持局部（前缀）索引。

举例1：创建表 test4，在表中的 info 字段上建立全文索引，SQL 语句如下：

```sql{6}
  CREATE TABLE test4(
  id INT NOT NULL,
  name CHAR(30) NOT NULL,
  age INT NOT NULL,
  info VARCHAR(255),
  FULLTEXT INDEX futxt_idx_info(info)
) ENGINE=MyISAM;

```

> 在 MySQL5.7 及之后版本中可以不指定最后的ENGINE了，因为在此版本中 InnoDB 支持全文索引。

举例2：创建了一个给title和body字段添加全文索引的表

```sql{5}
CREATE TABLE articles (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR (200),
  body TEXT,
  FULLTEXT index (title, body)
) ENGINE = INNODB;
```

举例3：

```sql{6}
CREATE TABLE `papers` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(200) DEFAULT NULL,
  `content` text,
  PRIMARY KEY (`id`),
  FULLTEXT KEY `title` (`title`,`content`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
```

同于like方式的的查询：

```sql
SELECT * FROM papers WHERE content LIKE '%查询字符串%';
```

全文索引用match+against方式查询：

```sql
SELECT * FROM papers WHERE MATCH(title,content) AGAINST ('查询字符串');
```

明显的提高查询效率。

:::warning 注意

使用全文索引前，搞清楚版本支持情况；

全文索引比 like + % 快 N 倍，但是可能存在精度问题；

如果需要全文索引的是大量数据，建议先添加数据，再创建索引。

:::

##### 创建空间索引

空间索引创建中，要求空间类型的字段必须为`非空`。

举例：创建表 test5，在空间类型为 GEOMETRY 的字段上创建空间索引，SQL 语句如下：‘

```sql{3}
CREATE TABLE test5(
  geo GEOMETRY NOT NULL,
  SPATIAL INDEX spa_idx_geo(geo)
) ENGINE=MyISAM;
```

该语句执行完毕之后，使用SHOW CREATE TABLE查看表结构：

```sql
SHOW INDEX FROM test5 \G
```

可以看到，test5 表的 geo 字段上创建了名称为`spa_idx_geo`的空间索引。注意创建时指定空间类型字段值的非空约束，并且表的存储引擎为 MyISAM。

### 在已存在的表中创建索引

在已存在的表中创建索引，可以使用`ALTER TABLE`语句或者使用`CREATE INDEX`语句。

#### ALTER TABLE创建索引

基本语法如下：

```sql
-- ALTER TABLE创建索引
ALTER TABLE table_name ADD [UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY]
[index_name] (col_name[length],...) [ASC | DESC]

-- 在创建索引时指定索引值降序或升序只在MySQL 8.x 版本生效
```

#### CREATE INDEX创建索引

CREATE INDEX语句可以在已存在的表中添加索引；在MySQL中，CREATE INDEX被映射到ALTER TABLE语句中，基本语法如下：

```sql
-- CREATE INDEX创建索引
CREATE [UNIQUE | FULLTEXT | SPATIAL] INDEX index_name
ON table_name (col_name[length],...) [ASC | DESC]

-- 在创建索引时指定索引值降序或升序只在MySQL 8.x 版本生效
```

## 查看索引

```sql
SHOW INDEX FROM table_name;
```

## 删除索引

在删除索引时，可以使用`ALTER TABLE`语句或者使用`DROP INDEX`语句。

### ALTER TABLE删除索引

```sql
ALTER TABLE table_name DROP INDEX index_name;
```

### DROP INDEX删除索引

```sql
DROP INDEX index_name ON table_name;
```

### 删除主键索引

可以通过删除主键约束的方式，来删除主键索引：

```sql
ALTER TABLE student DROP PRIMARY KEY;
```

:::warning 注意
声明了`AUTO_INCREMENT`约束字段的唯一索引无法直接删除

声明了`AUTO_INCREMENT`约束字段的主键索引也无法直接删除，因为主键索引本质上就是一种特殊的唯一索引
:::

### 删除联合索引

注意：删除表中的列时，需要要删除的列为索引的一部分，则该列会从索引中删除。如果组成索引的列全部被删除，则整个索引也会被删除。
