# drop、delete与truncate的区别？

## 口语化

MySQL中drop、delete与truncate 是用于删除数据的三个命令。但是它们之间还是有区别的。

- **DELETE 用于删除表中的一行或多行记录**，它可以与 WHERE 子句一起使用来指定要删除的记录。

- **TRUNCATE 用于快速删除表中的所有记录**，并重置任何自增的计数器（如自增的主键）

- **DROP 用于删除整个表结构及其数据。**

**DROP是最彻底的**，他不仅删除表中的数据，还删除表结构，并且操作**不可撤销**。

**DELETE是最慢的**，因为他再操作过程中会记录binlog，并且他是在事务中的，可以做回滚。

**DELETE可以和WHERE一起用，可以设置筛选条件**，而DROP和TRUNCATE是不可以增加筛选条件的。

**TRUNCATE和DROP是DDL(数据定义语言)操作，二DELETE是DML（数据操作语言）操作。**

> 注意：DELETE操作删除表中记录后，自增ID不会重置，而TRUNCATE操作则会重新从1开始自增。

## drop

DROP用于删除数据库对象，如表（结构及数据）、视图、索引等。可以删除表、数据库、视图、索引等

```sql
DROP TABLE table_name;
DROP DATABASE database_name;
```

特点：完全删除表及其所有数据。删除表后，表的结构和数据都将永久消失，且无法恢复（除非有备份）。不会触发DELETE触发器。无法回滚（不可逆操作）。

## delete

DELETE用于删除表中符合条件的行。只能删除表中的数据行。

```sql
DELETE FROM table_name WHERE condition;
```

特点：可以通过WHERE子句指定删除哪些行，如果没有WHERE子句，将删除表中所有行，但表结构和索引保留。删除操作会记录在事务日志中，因此可以回滚（可逆操作）。可以触发DELETE触发器。相对较慢，因为每行删除操作都会记录在日志中，并且需要考虑事务处理

## truncate

TRUNCATE用于快速删除表中的所有行。直接操作表中的所有数据行

```sql
TRUNCATE TABLE table_name;
```

特点：删除所有行，但保留表结构及其列、索引等元数据。比DELETE快，因为它不逐行删除数据，而是直接释放数据页。无法回滚（不可逆操作），但在某些数据库系统中，TRUNCATE可能被视为DDL操作，具体行为取决于数据库系统的实现。**重置自增列（AUTO_INCREMENT）计数器**。



| 特性     | DROP                                 | DELETE                         | TRUNCATE                             |
| -------- | ------------------------------------ | ------------------------------ | ------------------------------------ |
| 操作类型 | DDL             | DML                   | DDL                       |
| 作用对象 | 表、数据库、索引、视图等             | 表中的数据行                   | 表中的所有数据                       |
| 删除方式 | 删除整个表（记录+结构）                           | 可以有条件删除（记录）                 | 清空所有数据（记录）                       |
| 事务控制 | 不可回滚                             | 可回滚                         | 通常不可回滚（具体取决于数据库实现） |
| 日志记录 | 记录表结构变化                       | 记录每一行的变化               | 记录元数据变化                       |
| 性能     | 通常比DELETE快，因为它不逐行处理数据 | 较低（逐行删除，需要记录日志） | 高（重置数据页指针）                 |
| 支持where | 不支持                       | 支持  | 不支持                     |
| 主键重置   | 不支持，表都没了                                 | 不重置（除非有额外操作）       | 重置自增计数器                     |
| 触发器   | 不触发                               | 触发                           | 通常不触发（具体取决于数据库实现）   |

## 扩展

### DROP之后有办法恢复吗？

DROP操作非常危险，并且是不可逆的。一旦执行了，数据和表结构就会被立即删除。想要恢复非常困难，可以有以下几个方式，但是不见得一定能100%恢复：

1. **数据库备份**：如果你定期备份数据库，可以从最近的备份中恢复丢失的表。
2. **bin log**：如果MySQL服务器的二进制日志被启用并且在删除表之前已经记录了所有更改，理论上可以通过这些日志恢复数据。这需要重放日志文件直到删除操作之前的点。
3. **数据恢复工具**：存在一些专门的数据恢复工具，如 Percona Data Recovery Tool for InnoDB，这些工具可以在某些情况下帮助恢复删除的InnoDB表。但是，这些方法通常技术要求高，且不能保证100%恢复。
4. **文件系统备份**：如果数据库文件所在的文件系统被备份，那么可以尝试从文件系统备份中恢复整个数据库目录。

### 阿里规约

<span style="color: var(--alibaba-cankao-text-color);">【参考】</span>TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少，但 TRUNCATE 无事务且不触发 trigger，有可能造成事故，故不建议在开发代码中使用此语句。

<span style="color: var(--alibaba-shuoming-text-color);">说明：</span>TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同。
