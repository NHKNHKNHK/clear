# 单表数据量多少需要分表？

**阿里规约**

![1743041966427](assets/1743041966427.png)

在数据库设计中，单表数据量达到一定规模时，可能会对性能、存储和维护造成影响。是否需要分表取决于多个因素，而不仅仅是数据量本身。

[配合视频食用](https://www.bilibili.com/video/BV1aM4m1y7pw?spm_id_from=333.788.videopod.episodes&vd_source=b48089bbf3cd1948c3e907eb18c73f36&p=2)



**单表数据量的经验值**

虽然没有绝对的标准，但以下经验值可以作为参考：

-   **小表**：小于 100 万行，通常无需分表。
-   **中等表**：100 万 ~ 2000 万行，可以通过优化索引、查询等方式应对。
-   **大表**：超过 2000 万行，建议考虑分表或其他优化手段。
-   **超大表**：超过 5000 万行甚至上亿行，分表几乎是必然选择。

>   **注意**：这些数值仅为经验参考，具体分表阈值需根据实际场景调整。

**分表的常见策略**

如果决定分表，可以根据业务需求选择合适的分表策略：

(1) **水平分表**

-   将表中的数据按某种规则拆分到多个表中。
-   常见的拆分规则包括：
    -   **按时间**：如按年、月、日拆分（适合日志类数据）。
    -   **按 ID 范围**：如按主键范围拆分。
    -   **哈希取模**：如 `user_id % N` 分配到不同的表中。

(2) **垂直分表**

-   将表中的列拆分到多个表中。
-   适合字段较多且访问频率差异较大的场景（如将不常用的字段拆分到另一张表）。

(3) **混合分表**

-   结合水平分表和垂直分表的方式，适用于复杂场景。

**分表的优缺点**

优点

-   提高查询性能，减少单表的数据量。
-   降低单表的存储压力。
-   提升备份和恢复效率。

缺点

-   增加了系统复杂性（如跨表查询、事务管理）。
-   需要额外的开发和运维成本。

**其他优化手段**

在考虑分表之前，可以先尝试以下优化手段：

-   **索引优化**：添加合适的索引，避免全表扫描。
-   **分区表**：使用数据库的分区功能（如 MySQL 的分区表）。
-   **读写分离**：通过主从复制分担读请求压力。
-   **缓存**：使用 Redis 等缓存系统减轻数据库压力。

 **总结**

-   **单表数据量阈值**：一般建议单表数据量控制在 2000 万行以内，超过此规模应考虑分表。
-   **分表决策依据**：不仅看数据量，还需结合查询性能、存储容量、业务需求等因素综合判断。
-   **优先优化**：在分表之前，可以尝试索引优化、分区表、读写分离等手段。
-   **分表策略**：根据业务特点选择水平分表、垂直分表或混合分表。
