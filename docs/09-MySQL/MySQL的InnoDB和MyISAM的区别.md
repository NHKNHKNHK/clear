# MySQL的InnoDB和MyISAM的区别

## 口语化

MyISAM和InnoDB都是MySQL的存储引擎。

MySQL5.5之前，默认的存储引擎是MyISAM，从5.5之后，默认的是InnoDB。

MyISAM 适用于**读多**写少的场景，如数据仓库、日志分析等；InnoDB 适用于事务密集型和高并发场景，如在线交易系统、社交网络等。

> 关于更多MySQL中InnoDB和MyISAM的如何选择的细节可以查看：[MySQL中InnoDB和MyISAM的如何选择？](./MySQL中InnoDB和MyISAM的如何选择.md)

## 主要区别

- **聚簇索引**：
  - InnoDB 使用**聚簇索引**，主键索引和行数据存储在一起，查询主键时效率高；
  - MyISAM 使用非聚簇索引，**索引和数据分开存储**，主键索引只包含指向数据文件的指针（地址偏移量）。

- **辅助索引**：
  - InnoDB 的辅助索引存储索引列和主键值，通过主键找到实际数据；
  - MyISAM 的辅助索引存储索引列和数据文件指针，直接通过指针找到实际数据。

- **全文索引**：
  - MyISAM 原生支持全文索引，适合需要全文搜索的应用；
  - InnoDB 从 **MySQL 5.6 开始支持全文索引**，但在某些情况下性能可能不如 MyISAM。

- **索引大小**：
  - InnoDB 的索引由于包含行数据和事务日志，占用更多存储空间；
  - MyISAM 的索引文件较小，存储空间利用率较高。
- **索引锁定机制**：
  - InnoDB 使用**行级锁**，每次操作只锁定相关的行，适合高并发和写操作频繁的应用。
  - MyISAM 使用**表级锁**，每次操作都会锁定整个表，适合读多写少的应用

- **事务支持**：
  - InnoDB 支持**事务**，提供 ACID 特性（原子性、一致性、隔离性、持久性）。
  - MyISAM 不支持事务，无法进行回滚和提交操作；

- **外键支持**：
  - InnoDB **支持外键**，可以在表间建立引用完整性约束，保证数据的一致性和完整性。
  - MyISAM 不支持外键，无法在表间建立引用完整性约束；

- **数据一致性**：
  - InnoDB 支持**外键和事务**，能够自动保证数据的一致性和完整性；
  - MyISAM 不支持外键和事务，数据一致性需要通过应用层来处理。

- **数据存储结构**：
  - InnoDB 将**数据和索引**存储在表空间文件中，支持自动扩展和多表空间。（`.frm`文件存储表结构定义、`.idb`文件存储数据和索引）
  - MyISAM 将数据存储在三个文件中（`.frm`文件存储表结构，`.MYD`文件存储数据，`.MYI`文件存储索引）；

- **存储空间**：
  - MyISAM 存储空间效率较高，数据文件较小；
  - InnoDB 可能占用更多存储空间，特别是需要存储事务日志和外键约束信息。

- **表的大小限制**：
  - MyISAM 受文件系统限制，单个表最大可达 256TB（取决于文件系统）；
  - InnoDB 最大表大小可达 **64TB**，适合处理大规模数据集。

- **崩溃恢复**：
  - InnoDB 支持**自动崩溃恢复**，通过重做日志和回滚日志实现快速和完整的恢复。
  - MyISAM 只支持基于表的崩溃恢复，恢复过程较慢且不完全；

## InnoDB索引与MyISAM索引实现的区别

:::tip

MyISAM的索引方式都是非聚簇的，与InnoDB包含1个聚簇索引和多个非聚簇索引是不同的。

:::

- 在InnoDB存储引擎中，我们只需要根据主键值对聚簇索引进行一次查找就能找到对应的记录，而在MyISAM中却需要进行一次回表操作，意味着MyISAM中建立的索引相当于全部都是二级索引。

- InnoDB的**数据文件本身就是索引文件**（即：索引即数据，数据即索引），而MyISAM**索引文件和数据文件是分离的** ，索引文件仅保存数据记录的地址。
  - MyISAM的表在磁盘上存储在以下文件中： `*.sdi`（描述表结构）、`*.MYD`（数据）、`*.MYI`（索引）
  - InnoDB的表在磁盘上存储在以下文件中：`.ibd`（表结构、索引和数据都存在一起）

> 这里磁盘上存储的文件与上文不一致是因为MySQL版本的差异，这里说的是MySQL8版本，上文说的是MySQL5.7版本。

- InnoDB的非聚簇索引data域存储相应记录主键的值 ，而MyISAM索引记录的是地址 。换句话说，InnoDB的所有非聚簇索引都引用主键作为data域。
MyISAM的回表操作是十分快速的，因为是拿着地址偏移量直接到文件中取数据的，反观InnoDB是通过获取主键之后再去聚簇索引里找记录，虽然说也不慢，但还是比不上直接用地址去访问。

- InnoDB要求表必须有主键（ MyISAM可以没有 ）。如果没有显式指定，则MySQL系统会自动选择一个可以非空且唯一标识数据记录的列作为主键。如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整型。
