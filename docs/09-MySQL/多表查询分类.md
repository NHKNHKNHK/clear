---
permalink: /25/10/10/mysql/multi-table-query
---

# 多表查询分类

:::tip
按连接条件类型划分：等值连接 vs 非等值连接

按连接表的关系划分：自连接 vs 非自连接

按结果集包含范围划分：内连接 vs 外连接
:::

## 按连接条件类型划分

### 等值连接（Equijoin）

- 定义：使用等号（`=`）作为连接条件，匹配两表中列值相等的记录。

- 特点：最常用的连接方式，用于关联具有相同含义的列（如主键与外键）。

:::warning 注意
以下所有案例基于以下表结构：

employees（员工表）：emp_id（员工 ID，主键）、emp_name（姓名）、dept_id（部门 ID，外键）、manager_id（上级 ID，关联自身emp_id）

departments（部门表）：dept_id（部门 ID，主键）、dept_name（部门名称）

salary_grades（工资等级表）：grade（等级）、min_salary（最低工资）、max_salary（最高工资）

:::

示例

```sql
-- 等值连接（显式指定条件）
SELECT e.emp_name, d.dept_name
FROM employees e, departments d
WHERE e.dept_id = d.dept_id;

-- 等价的ANSI SQL内连接写法
SELECT e.emp_name, d.dept_name
FROM employees e
INNER JOIN departments d ON e.dept_id = d.dept_id;
```

### 非等值连接（Non-equijoin）

- 定义：使用非等号（如>, <, BETWEEN...AND...等）作为连接条件，匹配列值满足范围或不等式关系的记录。
- 特点：用于关联列值存在范围对应关系的表（如工资与工资等级）

示例：查询所有员工的姓名、工资及对应的工资等级

```sql
SELECT e.emp_name, e.salary, g.grade
FROM employees e
JOIN salary_grades g 
  ON e.salary BETWEEN g.min_salary AND g.max_salary;
```

## 按连接表的关系划分

### 自连接（Self-Join）

- 定义：同一表与自身进行连接，需为表起不同别名以区分 "两个表"。
- 特点：用于查询表中具有层级或关联关系的记录（如员工与上级的关系）。

示例：查询所有员工的姓名及对应的上级姓名

```sql
SELECT e.emp_name AS 员工姓名, m.emp_name AS 上级姓名
FROM employees e
LEFT JOIN employees m 
  ON e.manager_id = m.emp_id; -- 自身连接：员工表同时作为"员工"和"上级"
```

### 非自连接（Non-Self Join）

- 定义：不同表之间的连接（最常见的多表查询场景）。
- 特点：用于关联业务上属于不同实体的表（如员工与部门、订单与客户）。

示例：查询部门名称为 "研发部" 的所有员工姓名

```sql
SELECT e.emp_name
FROM employees e
JOIN departments d 
  ON e.dept_id = d.dept_id
WHERE d.dept_name = '研发部'; -- 员工表与部门表（不同表）连接
```

## 按结果集包含范围划分

### 内连接（Inner Join）

- 定义：只保留两表中满足连接条件的记录，不满足条件的记录会被过滤。
- 特点：结果集是两表的 "交集"，默认连接方式（若省略INNER关键字）。

示例：查询同时存在于员工表和部门表中的员工及部门信息（即已分配部门的员工）

```sql
SELECT e.emp_id, e.emp_name, d.dept_name
FROM employees e
INNER JOIN departments d ON e.dept_id = d.dept_id; 
-- 未分配部门（dept_id为NULL）的员工不会出现在结果中
```

### 外连接（Outer Join）

- 定义：除保留满足条件的记录外，还会保留其中一个表（或两个表）中不满足条件的记录，未匹配的列用NULL填充。

- 分类：
  - 左外连接（Left Outer Join）：保留左表所有记录，右表不匹配则补NULL。
  - 右外连接（Right Outer Join）：保留右表所有记录，左表不匹配则补NULL。
  - 全外连接（Full Outer Join）：保留两表所有记录，不匹配的一侧补NULL（部分数据库如 MySQL 不直接支持，需用UNION模拟）。

示例1：左外连接：查询所有员工（包括未分配部门的）及其部门名称

```sql
SELECT e.emp_name, d.dept_name
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id;
-- 未分配部门的员工，dept_name显示为NULL
```

示例2：右外连接：查询所有部门及其员工名称（包括未分配部门的）

```sql
SELECT d.dept_name, e.emp_name
FROM employees e
RIGHT JOIN departments d ON e.dept_id = d.dept_id;
-- 无员工的部门，emp_name显示为NULL
```

## 补充：笛卡尔积|交叉连接（Cross Join）

- 定义：不指定连接条件，返回两表的笛卡尔积（左表每条记录与右表每条记录组合）。
- 特点：结果集行数 = 左表行数 × 右表行数，通常需配合WHERE过滤无效记录

示例：查询员工表与部门表的所有可能组合（无实际业务意义，仅为演示笛卡尔积）

```sql
SELECT e.emp_name, d.dept_name
FROM employees e
CROSS JOIN departments d;
```
