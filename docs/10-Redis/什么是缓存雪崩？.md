# 什么是缓存雪崩？

## **口语化**

缓存雪崩主要是在同一时间，系统大量缓存的key失效或者是Redis服务宕机，这个时候的大量请求都要打到数据库，增加了数据库压力，导致数据库崩溃或者不可用，一般如果产生了雪崩，就是比较严重的后果。

雪崩主要的解决方案，一方面是**设置合理的缓存过期时间，不要让同一时间失效，尽量的分散**。另一个方案就是可以在比如服务刚启动的时候，进行**缓存的预热**，防止刚启动的时候，大量请求打到数据库。另一方面也要提升**缓存架构的高可用**，避免因为缓存服务的问题，导致请求打到数据库



产生原因：在同一时刻内**大量缓存的key失效或者是Redis服务宕机**，导致大量请求都打到数据库

## 解决方案

-   给不同的key的TTL添加随机值，让它们不再同时过期
-   热点数据预热，防止刚启动的时候，大量请求打到数据库
-   部署高可用的redis服务（如哨兵、集群）
-   给缓存业务添加降级限流策略（ngxin或spring cloud gateway）
-   给业务添加多级缓存（Guava或Caffeine）

### **设置合理的缓存过期时间**

缓存过期时间的设置需要根据业务需求和数据的变化频率来确定。

-   对于不经常变化的数据，可以设置较长的过期时间，以减少对数据库的频繁访问。

-   对于经常变化的数据，可以设置较短的过期时间，确保缓存数据的实时性。

总之就是尽量打散缓存的过期时间，最好做到均匀的时间分布，减轻系统同一时刻的压力。

### **使用热点数据预加载**

预先将热点数据加载到缓存中，并设置较长的过期时间，可以避免在同一时间点大量请求直接访问数据库。可以根据业务需求，在系统启动或低峰期进行预热操作，将热点数据提前加载到缓存中。

热点数据预加载可以提升系统的性能和响应速度，减轻数据库的负载。

### **缓存高可用**

缓存做成集群的形式，提高可用性，防止缓存挂掉后，造成的穿透问题。

当缓存服务器发生故障或宕机时，需要有相应的故障转移和降级策略。可以通过监控系统来及时发现缓存故障，并进行自动切换到备份缓存服务器。同时，可以实现降级策略，当缓存失效时，系统可以直接访问数据库，保证系统的可用性。通过缓存故障转移和降级策略，可以保证系统在缓存不可用或故障的情况下仍然可以正常运行，提高系统的稳定性和容错性。

