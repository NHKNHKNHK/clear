# Redis可以实现事务吗？|什么是redis事务机制？

## **口语化**

redis**支持事务，但是它和传统关系型数据库中的事务是有所不同的**。只是保证了正常情况下的原子性，异常情况不提供回滚机制。redis的事务主要是将一组命令放在一个队列，一起准备顺序执行。主要是 multi、exec、watch 命令配合使用。使用非常简单，先标记事务开始后，放入命令，再通过 exec 执行即可



Redis 事务是一个单独的隔离操作：**事务中的所有命令都会序列化、按顺序地执行**。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。

Redis 事务的主要作用就是**串联多个命令**防止别的命令插队。

注意：

​	**==Redis单条命令保证原子性，但是事务不保证原子性==**

## **常用命令**

-   **multi**

MULTI命令用于标记一个事务的开始。执行MULTI后，客户端的所有的命令都会被放入一个队列中，而不是立即执行。

-   **exec**

执行队列中的所有命令 

所有命令会按顺序执行，并且在执行过程中不会被其他客户端的命令打断。

Redis事务在执行EXEC命令时具有原子性，即所有命令要么全部执行，要么全部不执行。

**Redis事务并不支持回滚机制**。如果在事务执行过程中发生错误，已经执行的命令不会被回滚

-   **discard**

DISCARD命令用于放弃从MULTI命令开始后放入队列中的所有命令（**即清空事务队列），并且取消事务**

-   **watch key1 key2 ...**

监视一个（或多个）key，如果在事务执行之前这个（或这些）key被其他命令所改动，那么事务将被打断

WATCH命令通常用于实现乐观锁。这样可以防止事务中的数据竞争问题

示例

```shell
# 开始事务
MULTI
# 添加命令到事务队列
SET key1 value1
SET key2 value2
# 执行事务
EXEC
```

如果在事务执行之前，使用WATCH命令监视了某个键，并且该键在事务执行前被修改，事务将被中止：

```shell
# 监视键
WATCH key1
# 开始事务
MULTI
# 添加命令到事务队列
SET key1 value1
SET key2 value2
# 执行事务（如果key1在此之前被修改，事务将被中止）
EXEC
```

## **事务的执行过程（工作原理）**

**1、 开始事务**：使用MULTI命令开始一个事务。

**2、 命令入队**：在事务开始之后，所有的命令都会被放入队列中，而不是立即执行。

**4、 执行事务**：使用EXEC命令执行队列中的所有命令。如果在使用WATCH监视的键在事务执行前被修改，事务将被中止。

**4、 放弃事务**：使用DISCARD命令可以放弃当前事务队列中的所有命令。


