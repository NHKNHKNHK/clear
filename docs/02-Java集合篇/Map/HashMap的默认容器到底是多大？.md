# HashMap的默认容器到底是多大？

>   关键点：如果不指定容量，默认是16，如果指定，那么默认是2的n次幂

使用默认的构造器创建HashMap时，初始容量为 16，默认加载因子为 0.75

```java
HashMap<String, Integer> map = new HashMap<>();
```

当你初始化HashMap时，指定的初始容量会被调整为大于或等于该值的最小的 2 的幂次。

例如，如果你指定的初始容量是 10，HashMap会将其调整为 16（2^4）。

具体实现如下：

```java
/**
 * 根据给定的目标容量返回一个2的幂大小。
 * 这个方法通过将目标容量向上舍入到最接近的2的幂来确定哈希表的大小，
 * 以提高哈希表的装载因子，从而在给定容量需求下提供更高效的性能。
 * 
 * @param cap 目标容量，用于计算哈希表的大小。
 * @return 返回一个2的幂大小，该大小大于或等于目标容量。
 */
static final int tableSizeFor(int cap) {
    // 对目标容量进行一系列位操作，以找到大于或等于目标容量的最小2的幂
    int n = cap - 1;
    n |= n >>> 1;
    n |= n >>> 2;
    n |= n >>> 4;
    n |= n >>> 8;
    n |= n >>> 16;
    // 确保返回值在有效范围内，如果计算结果超出最大容量，则返回最大容量
    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}

```

这个方法通过一系列的位移和按位或操作，将任意整数调整为大于或等于它的最小 2 的幂次。但是还有一种特殊情况套用以上公式不行，这些数字就是2的幂自身。如果数字4 套用公式的话。得到的会是 8 ，为了解决这个问题，JDK的工程师把所有用户传进来的数在进行计算之前先-1。
